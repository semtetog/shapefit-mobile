import React, { useEffect, useRef, useState } from 'react'; declare global { interface Window { JustGage: any; } } export const ProfileOverviewLogic = ({ setView }: { setView: (view: string) => void }) => { const imcGaugeRef = useRef<HTMLDivElement>(null); const [imcValue, setImcValue] = useState(22.5); useEffect(() => { let isMounted = true; let retryTimeout: NodeJS.Timeout | null = null; const initializeGage = () => { if (imcGaugeRef.current && typeof window.JustGage !== 'undefined') { if (!isMounted) return; imcGaugeRef.current.innerHTML = ''; new window.JustGage({ id: imcGaugeRef.current.id, value: imcValue.toFixed(2), min: 15, max: 40, title: " ", label: " ", symbol: '', pointer: true, pointerOptions: { toplength: 8, bottomlength: 8, bottomwidth: 2, color: '#E0E0E0' }, gaugeWidthScale: 0.6, customSectors: { percents: false, ranges: [{ color: "#3498db", lo: 15, hi: 18.49 }, { color: "#2ecc71", lo: 18.5, hi: 24.99 }, { color: "#f1c40f", lo: 25, hi: 29.99 }, { color: "#e67e22", lo: 30, hi: 34.99 },{ color: "#e74c3c", lo: 35, hi: 40 }] }, counter: true, relativeGaugeSize: true, donut: true, valueFontColor: "#E0E0E0", valueFontFamily: "Poppins, sans-serif", titleFontFamily: "Poppins, sans-serif", labelFontFamily: "Poppins, sans-serif" }); } else { retryTimeout = setTimeout(initializeGage, 50); } }; initializeGage(); return () => { isMounted = false; if (retryTimeout) { clearTimeout(retryTimeout); } /* TODO: JustGage doesn't have a public 'destroy' method documented for easy cleanup. If it did, it would be called here. As a fallback, we ensure its container is cleared. For a more robust solution with libraries like this, consider creating a custom hook that manages the lifecycle of the external library instance more tightly. */ if (imcGaugeRef.current) { imcGaugeRef.current.innerHTML = ''; } }; }, [imcValue]); return ( <div className="p-4 bg-gray-900 min-h-screen text-gray-200 font-sans"> <h1 className="text-3xl font-bold mb-6 text-center text-white">Profile Overview</h1> <div className="flex justify-center items-center mb-8"> <div id="imc-gauge" ref={imcGaugeRef} data-value={imcValue} className="w-64 h-64"></div> </div> <div className="flex justify-center space-x-4"> <button onClick={() => setView("Dashboard")} className="px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg shadow-md transition duration-300"> Go to Dashboard </button> <button onClick={() => setView("Settings")} className="px-6 py-3 bg-gray-700 hover:bg-gray-600 text-white font-semibold rounded-lg shadow-md transition duration-300"> Edit Profile </button> </div> <div className="mt-8 p-6 bg-gray-800 rounded-lg shadow-lg max-w-lg mx-auto"> <h2 className="text-2xl font-semibold mb-4 text-white">Your Health Metrics</h2> <p className="text-gray-300 mb-2">Current BMI: <span className="font-bold text-green-400">{imcValue.toFixed(2)}</span></p> <p className="text-gray-300">Status: <span className="font-bold text-yellow-400">Normal Weight (Example)</span></p> <button onClick={() => setImcValue(prev => (prev < 39 ? prev + 1.5 : 17))} className="mt-4 mr-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white font-semibold rounded-md transition duration-300"> Simulate BMI Change </button> <button onClick={() => setView("HealthHistory")}
          className="mt-4 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-md transition duration-300"
        >
          View Health History
        </button>
      </div>
    </div>
  );
};