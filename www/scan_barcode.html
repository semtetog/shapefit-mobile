<div class="app-container">
<style>
        /* === ESTILO PARA SCANNER NATIVO === */
        :root {
            --scanner-border-color: #FF7A1A;
        }

        html {
            height: 100%;
            width: 100%;
        }

        body {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            background-color: #121212;
            font-family: 'Montserrat', sans-serif;
            color: white;
            transition: background-color 0.3s ease; 
        }

        /* Quando o scanner está ativo, o corpo fica transparente para ver a câmera atrás */
        body.scanner-active,
        html.scanner-active {
            background-color: transparent !important;
            background: transparent !important;
            --background: transparent !important;
        }

        body.scanner-active .scanner-container {
            background: transparent !important;
        }

        body.scanner-active .hide-on-scan {
            display: none;
        }

        .scanner-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            position: relative;
            z-index: 1;
        }

        /* === A MÁGICA DA MÁSCARA (CSS MASK) === */
        .scan-mask {
            display: none;
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        body.scanner-active .scan-mask {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .scan-hole {
            width: 80%;
            max-width: 300px;
            aspect-ratio: 1/1;
            border-radius: 20px;
            position: relative;
            background: transparent !important;
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.85); 
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        /* Cantos ativos laranja - solução simples e compatível */
        .scan-corner {
            position: absolute;
            width: 30px;
            height: 30px;
            border: 3px solid var(--scanner-border-color);
        }

        .scan-corner.top-left {
            top: -3px;
            left: -3px;
            border-right: none;
            border-bottom: none;
            border-top-left-radius: 20px;
        }

        .scan-corner.top-right {
            top: -3px;
            right: -3px;
            border-left: none;
            border-bottom: none;
            border-top-right-radius: 20px;
        }

        .scan-corner.bottom-left {
            bottom: -3px;
            left: -3px;
            border-right: none;
            border-top: none;
            border-bottom-left-radius: 20px;
        }

        .scan-corner.bottom-right {
            bottom: -3px;
            right: -3px;
            border-left: none;
            border-top: none;
            border-bottom-right-radius: 20px;
        }

        .scan-line {
            width: 100%;
            height: 2px;
            background: var(--scanner-border-color);
            box-shadow: 0 0 4px var(--scanner-border-color);
            position: absolute;
            animation: scanMove 2s infinite linear;
        }

        @keyframes scanMove {
            0% { top: 10%; opacity: 0; }
            50% { opacity: 1; }
            100% { top: 90%; opacity: 0; }
        }

        /* UI Sobreposta */
        .ui-layer {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: env(safe-area-inset-top) 20px 40px 20px;
            box-sizing: border-box;
            pointer-events: none;
        }

        .header-controls, .footer-controls {
            pointer-events: auto;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(5px);
            padding: 15px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .header-controls { justify-content: space-between; }
        .footer-controls { flex-direction: column; width: 100%; }

        .btn-icon {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            width: 40px; height: 40px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            font-size: 18px;
        }

        .manual-input-group {
            display: flex; width: 100%; gap: 10px;
        }
        
        .manual-input {
            flex: 1; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
            padding: 12px; border-radius: 8px; color: white;
            font-size: 16px;
        }

        h1 { margin: 0; font-size: 18px; }

        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-box {
            background: #1e1e1e;
            padding: 25px;
            border-radius: 16px;
            text-align: center;
        }
    </style>
<!-- Máscara Escura com o "Buraco" (Só aparece quando scanner ativo) -->
    <div class="scan-mask">
        <div class="scan-hole">
            <div class="scan-corner top-left"></div>
            <div class="scan-corner top-right"></div>
            <div class="scan-corner bottom-left"></div>
            <div class="scan-corner bottom-right"></div>
            <div class="scan-line"></div>
        </div>
    </div>

    <!-- Camada de UI (Fica por cima de tudo) -->
    <div class="ui-layer">
        <!-- Topo -->
        <div class="header-controls">
            <button class="btn-icon" onclick="stopScanAndLeave()">
                <i class="fas fa-arrow-left"></i>
            </button>
            <h1>Escanear Produto</h1>
            <button class="btn-icon" onclick="toggleTorch()">
                <i class="fas fa-bolt"></i>
            </button>
        </div>

        <!-- Rodapé -->
        <div class="footer-controls">
            <div style="margin-bottom: 10px; font-size: 14px; text-align: center; opacity: 0.8;">
                Aponte a câmera para o código de barras
            </div>
            
            <div class="manual-input-group">
                <input type="number" id="manual-code" class="manual-input" placeholder="Ou digite o código aqui">
                <button class="btn-icon" style="border-radius: 8px; background: var(--scanner-border-color);" onclick="handleManual()">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-box">
            <i class="fas fa-spinner fa-spin" style="font-size: 30px; color: var(--scanner-border-color); margin-bottom: 15px;"></i>
            <p>Buscando produto...</p>
        </div>
    </div>

<script src="./assets/js/pages/scan_barcode.js"></script>
</div>